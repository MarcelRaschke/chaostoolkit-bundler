language: python
matrix:
  include:
  - os: linux
    dist: trusty
    python: 3.6
  - os: osx
    language: generic

env:
  global:
  - GH_USER: "chaostoolkit-ci"
  - secure: "hOh/7v79yRmo9Vlr/0JIDXxNWkV5XMn6KWr/6lWDmdKVGN5rApNHTez1IZYKLVap668omCkO63opeireeCj1Vq411vi+9IaXkGr/+HxCyLoPVB0FchOSU/ZwQJ73a7Z2A/TRw82WFdQukG53Qu1FGCcNLXJRV5GlpbSJYEHkRQDmsHyFL6v98qqDdQxZjRtIUC8uy9YNiby97NFJ4a8ULd8fT3oO4Cdh5OzF7UVdZw3QrA30NeDnH6MGMC36VPXw1EOT2BeYKM64ffFiDn8+60WFvkHb413h+9qVIW5BsmoHGwIxIVa/Xr7PEn8/KVsuBl87AWp4PByuFc8+tFBdrypWOAbP7vsURk2/oMdd47caHzHkfIUMT0+4zueXK9BGK2l9A4QXYQfREuvNd6PBvFpM/DNn2UMlFZWiu7+DncvIuwekSZyDc4ba19IH89uztu7sgTSyv31iJWZRmbORPrBmQm6t/66jJlp/KE6V+qJn0IQV0KfMv8jWhQWJqrg6nTQdQdpm9aeyChFqBaY7OHLmjO6G5WGJFnWRzABCwY3oz0g2S/lYY3t6216G4lNEGgBnjYnuny2r6WAEwqBtblldAAGc+dzqsoJnMDmVCvA2Pjw9FgGKP9CzxBOeMXxlfzeZLJZPlcdohc4w6sS53ZqkHG6EoZw9QT79WkbpqF0="
  - secure: "hNXbarN5CrrEwaaBASUCXULH8YZe0w/2Rc7s7SNNOI/mT2iTvro+/318I1SATbeafXHk5D0+idid62fJ55XFybH9xtiaAtXB1uxNk6Gkp0IeoxhzPZGYhWOnLTsS6ePutgprUVgq1RczdttVgATUOtd4s3gS/6RW19tsocShL5NECBp7sH9Fb+B2bE3/N6TMecSFy8s5U5aehM/8nASf3OtgYxm03W9vHnmJABQmnSF5AjeRzFXYyx2IiPijLL70e25SAE9KWKXdUxwdsus7tpJA+o6sGaXJScG50I5yjP11Jm1+rTI7N6Cea0/pfQaVyQuzxAfZtW8xzkVfbOqTonST03T4/FOO2auTpZuUb5/pMlkCSGLl/bHz8Bkel3MAnQpSbk7jbdppwaIjh19rwcbVjxesQy+HE3aVU2pPVW9Kw2aiYvIge2s5ZGuixwu0guTqkkOBPQYCHwwZrqLsc7GYNelS3z8PmRbWxEhiCIJ5V/oj0V5+4fBtaXk9qn87ISkduACSTltgSFua3jPQ6zZDcqzTcmam2BQlyA6xzGdwG8tYDWHHmdsYI3Vprk/wtprLsxSMhZRmC0yqacnTVL4RTVUrldSP5bzIA+EbXFg0INjvRoJPaYKG6a2hHKrozaHbsAvxFryYgqstEiArxyWAfkagvUNlZoB8f46Gxcs="

before_install: |
  if [ "$TRAVIS_OS_NAME" == "osx" ]; then
    brew upgrade python3
    python3 --version
    python3 -m pip install -U pip
    which pip3
  fi
install:
- pip3 install -U pip setuptools
- pip3 install -U -r requirements.txt -r requirements-chaostoolkit.txt
script:
- bash ci.bash

branches:
  only:
    - master

notifications:
  webhooks:
    urls:
    - https://webhook.atomist.com/atomist/travis/teams/T76U4GPGF
    on_cancel: always
    on_error: always
    on_start: always
    on_failure: always
    on_success: always

deploy:
  provider: releases
  api_key:
    secure: Y2xTZ2bTDFzFdAnD8wrlSi1yT/YCV9mfyJyr6mQO1UqB8AUhTZ1UguTmQWdIM/lFoLRPmo41ptNvpNqMqEGer+BsgqhVsD8DwG4E1y7IhioUJTxtdw3OvxKmG4iCosQEND/Beis+DCGe7uPJ5YCoXuCmVWLJBx3FbGwJ8z05Z5gauk/6589Usii/hReMZ4a1R5ajKd/lZK2USRMr0vBovd/HcxCJhMsF8spc43I8kiLga7ZTFru2n3FkuGeJNpT/+VjTX2WhmiGOA3LAyvdg1o57JS5bvsGHFZ0eRc1n/YnPqa8rDrwD+gV/aELqAB6cFyxrF2fBq1XxhKS5iBQV94q+wUX63mxgxSltpux15k9sPMD8/BMTiCH6akgNbriagVE9iLHVe8QCfBW6yabrTBE5bcMrugOsVbRdslhUd2BHPnosyEDXMjjKKCwLV2/dscCuardQgAyj2ANwFmS7IUgBNOmh9sm2/KPO9cPpb/ULlY6DX6NgnC0uHAV7uk7vEKMWpIf1JKD/hUckPXOPmEneXIW86z1hY0uOnVL8TPPDaY35FhrMHFU/nr2roZsSwRE4kISSb7CJ6m6tMR37rt/c3R2Btqa///4G+EAhI4kjpi0iStPrt9UMPLgCi2zmQrV2VBNuuM/53KEd4ZxmF7HXKAFzzeySehbIStPJVoI=
  file: dist/*
  file_glob: true
  on:
    repo: chaostoolkit/chaostoolkit-bundler
    tags: true
  skip_cleanup: true
  tag_name: $TRAVIS_TAG
  draft: false